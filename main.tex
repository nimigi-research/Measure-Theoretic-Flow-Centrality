% =====================================================================
% Measure-Theoretic Flow Centrality
% Occupancy, Spectral Tilts, and Invariant Routing Diagnostics
% Monolithic main.tex — full replacement
% =====================================================================
\documentclass[11pt]{article}

% ---------- Packages ----------
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{amsmath,amsthm,amssymb,mathtools,bm}
\usepackage{bbm}
\usepackage{xcolor}
\usepackage{microtype}
\usepackage{enumitem}
\usepackage{thmtools}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{booktabs}

\usepackage[colorlinks=true,linkcolor=blue!60!black,citecolor=teal!50!black,urlcolor=magenta!50!black]{hyperref}
\usepackage[nameinlink,capitalize,noabbrev]{cleveref}

% ---------- Bibliography ----------
\usepackage[backend=biber,style=authoryear,doi=false,isbn=false,url=false,maxcitenames=2,maxbibnames=9]{biblatex}
\addbibresource{refs.bib} % unified, global bibliography

% ---------- Theorem-like environments ----------
\declaretheorem[name=Theorem,numberwithin=section]{theorem}
\declaretheorem[name=Proposition,sibling=theorem]{proposition}
\declaretheorem[name=Lemma,sibling=theorem]{lemma}
\declaretheorem[name=Corollary,sibling=theorem]{corollary}
\declaretheorem[name=Definition,sibling=theorem]{definition}
\declaretheorem[name=Remark,sibling=theorem]{remark}
\declaretheorem[name=Example,sibling=theorem]{example}

% ---------- Macros ----------
\newcommand{\E}{\mathbb{E}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Prob}{\mathbb{P}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\KL}{\mathrm{KL}}
\newcommand{\TV}{\mathrm{TV}}
\newcommand{\Wone}{W_1}
\newcommand{\dist}{\mathrm{dist}}
\newcommand{\supp}{\mathrm{supp}}
\newcommand{\Id}{\mathrm{Id}}
\newcommand{\1}{\mathbbm{1}}

\newcommand{\F}{\mathcal{F}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\Y}{\mathcal{Y}}
\newcommand{\Pcal}{\mathcal{P}}

% ---------------------------------------------------------------------
\title{\textbf{Measure-Theoretic Flow Centrality: Occupancy, Spectral Tilts,\\
and Invariant Routing Diagnostics on Quotient Flows}}
\author{Jacob Alexander Elliott}
\date{\today}
% ---------------------------------------------------------------------

\begin{document}
\maketitle

\begin{abstract}
We develop a measure-theoretic notion of \emph{Flow Centrality} for stochastic routing and inference systems. The construction begins with occupancy events on Markov flows and lifts to \emph{tilted} path ensembles whose log-partition equals a log spectral radius. Centrality scores arise as derivatives of this potential with respect to node/edge restrictions, delivering \emph{Action--Betweenness} diagnostics that identify fragile channels. The same potential yields a convex rate function governing occupancy large deviations, which we use to define \emph{Murphy horizons} for discovery schedules. We prove invariance and stability under quotienting (QFI), connect limiting cases to classical centralities (random-walk betweenness and current-flow centrality), and give algorithms based on sensitivity of the Perron root and matrix perturbation. The framework interoperates with FI/CRLB transport via Blackwell sufficiency, with ergodic drift guarantees, and with compile-time safety contracts that ensure measurable, support-respecting kernels. Claim-specific citations: random-walk and current-flow centralities \parencite{Newman2005,DoyleSnell1984}, spectral graph theory \parencite{Chung1997}, mixing/occupancy baselines \parencite{LevinPeresWilmer2009,KemenySnell1976}, large deviations via tilted spectra \parencite{DemboZeitouni1998}, FI transport \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982}, quotient invariants \parencite{elliott2025qfi}, drift coverage \parencite{MeynTweedie2009,elliott2025drift}, and compile-time contracts \parencite{elliott2025contracts,elliott2025graded}.
\end{abstract}

% =========================
\section{Introduction}\label{sec:intro}
% =========================
Centrality is about \emph{where the flow must go}. In stochastic pipelines, “flow” is an occupancy measure generated by a Markov kernel on a graph or state space; bottlenecks are those structures whose removal causes the largest increase in the cost of achieving an event or maintaining throughput. We formalize this intuition with a measure-theoretic potential:
\[
\Lambda(t;S)\ :=\ \log \rho\!\left(\mathrm{diag}(e^{t\cdot \1_S})\,P\right),
\]
where $P$ is a (possibly lumped) transition matrix, $S$ is an occupancy target (node set, edge-lift set, or action set), and $\rho(\cdot)$ is the spectral radius. The Legendre dual $I(\theta)=\sup_{t}\{t\theta-\Lambda(t)\}$ is the large-deviation rate for the time-average occupancy of $S$ \parencite{DemboZeitouni1998}. This single object powers:
\begin{itemize}[leftmargin=1.25em]
\item \textbf{Occupancy centrality:} $\Lambda'(0;S)=\pi(S)$ and, more generally, $d\Lambda/dt$ gives the tilted occupancy---a sensitivity of long-run flow to targeted emphasis.
\item \textbf{Action--Betweenness:} derivatives of $\Lambda$ w.r.t.\ edge/node restrictions quantify fragility; forbidding a feature that spikes the derivative is routing dynamite.
\item \textbf{Murphy horizons:} $L_c(\theta;\alpha,\beta)\approx \log(1/\beta)/(\alpha\,I(\theta))$ schedule finite-time discovery of $S$ when it is rare (Section~\ref{sec:murphy}).
\end{itemize}
We call the resulting scores \emph{Flow Centrality}. They are invariant to admissible quotientings (QFI) and reduce to known centralities in classical limits.

\paragraph{Related work and limits we connect to.}
Random-walk betweenness \parencite{Newman2005} and current-flow/effective-resistance diagnostics \parencite{DoyleSnell1984} arise as special cases (reversible chains; linear response near $t=0$). Kemeny’s constant, commute times, and mixing underlie baseline occupancies \parencite{KemenySnell1976,LevinPeresWilmer2009}. Spectral graph theory provides the stability/sensitivity tools \parencite{Chung1997}. Our quotient-invariance extends these ideas to coarse-grained flows that support LDP-level scheduling and FI/CRLB-aware compression \parencite{elliott2025qfi,Blackwell1953,AmariNagaoka2000,Cencov1982}.

\paragraph{Contributions.}
\begin{enumerate}[leftmargin=1.3em]
\item A measure-theoretic potential $\Lambda$ whose parameter derivatives define \emph{Flow Centrality} and \emph{Action--Betweenness}.
\item LDP-based Murphy horizons for finite-time discovery and their stability under quotienting.
\item Equivalence/limit theorems to random-walk and current-flow centralities.
\item Algorithms (sparse, perturbation-based) and a Mathematica implementation.
\end{enumerate}

% =========================
\section{Preliminaries}\label{sec:prelim}
% =========================
Let $G=(V,E)$ be finite; $P\in\R^{n\times n}$ is row-stochastic, irreducible on a class $C\subseteq V$, with stationary $\pi$. For an indicator $f:V\to\{0,1\}$, define the event $S=\{v:f(v)=1\}$ and the tilt operator $D_t=\mathrm{diag}(e^{t f})$. The \emph{tilted kernel} is $P_t:=D_t P$. Let $\rho(t):=\rho(P_t)$ and $\Lambda(t):=\log\rho(t)$.

\paragraph{Quotient flows.}
Given a partition $\mathcal{P}=\{B_1,\dots,B_m\}$, the lumped (quotient) kernel is $P^{\downarrow}\in\R^{m\times m}$ with $P^{\downarrow}(i,j)=\Prob(X_{k+1}\in B_j\mid X_k\in B_i)$ (well-defined under ordinary lumpability; otherwise treat as an aggregation with dispersion $\varepsilon_{\mathrm{lump}}$). Tilting on the quotient is $P^{\downarrow}_t:=\mathrm{diag}(e^{t f^{\downarrow}})P^{\downarrow}$ with $f^{\downarrow}(B)=\E[f(X)\mid X\in B]$ \parencite{elliott2025qfi}.

\paragraph{Occupancy LDP.}
For the empirical mean $\bar f_T=\frac1T\sum_{t=0}^{T-1} f(X_t)$, $\bar f_T$ satisfies an LDP with good convex rate $I$ given by the Legendre dual of $\Lambda$ \parencite[Chs.~3--4]{DemboZeitouni1998}. This is the workhorse for horizons.

% =========================
\section{Flow Centrality via spectral tilts}\label{sec:centrality}
% =========================
\begin{definition}[Flow centrality]
For target $S$ with indicator $f$, define
\begin{align*}
\text{Occ}(S;t) &:= \frac{d}{dt}\Lambda(t;S) \quad \text{(tilted occupancy)},\\
\text{Occ}''(S;t) &:= \frac{d^2}{dt^2}\Lambda(t;S) \quad \text{(tilted curvature)},\\
\text{AB}(F;t) &:= \frac{d}{d\epsilon}\Big|_{\epsilon=0^+} \Lambda\bigl(t;S\,\big|\,\text{restrict feature }F \text{ by } \epsilon\bigr)
\end{align*}
where $F$ is a node, edge, or action whose restriction reduces the corresponding entries of $P_t$.
\end{definition}

\paragraph{Linear response at $t=0$.}
Let $r,\ell$ be right/left Perron eigenvectors of $P$ with normalization $\ell^\top r=1$. Standard perturbation gives
\[
\Lambda'(0)=\frac{\ell^\top (f\odot r)}{\ell^\top r}=\pi(S),
\]
the stationary occupancy; second derivative recovers asymptotic variance rates \parencite{Chung1997,LevinPeresWilmer2009}. This anchors Flow Centrality at the classical baseline.

\paragraph{Action--Betweenness (AB).}
Let $E_{uv}$ denote the rank-one matrix that subtracts $\delta$ probability from edge $u\to v$ and redistributes proportionally on the row remainder to keep stochasticity. Then
\[
\text{AB}(u\!\to\! v;t)= -\,\ell_t(u)\, r_t(v)\,\frac{\partial \log \rho(t)}{\partial P_t(u,v)},
\]
where $\ell_t,r_t$ are Perron eigenvectors of $P_t$ normalized by $\ell_t^\top r_t=1$. The score spikes when $u\!\to\! v$ carries critical tilted flux. In reversible limits and $t\to 0$, AB reproduces random-walk/current-flow betweenness rankings \parencite{Newman2005,DoyleSnell1984}.

\paragraph{Node/edge centrality vectors.}
Collect AB over edges or aggregate to nodes (sum of incident AB) to obtain centrality vectors. Normalization by $\sum_{e}\text{AB}(e;t)$ yields interpretable shares of routing fragility.

% =========================
\section{Quotient invariance and stability}\label{sec:qfi}
% =========================
\begin{theorem}[QFI invariance up to lump error]\label{thm:qfi}
Let $P$ lump to $P^{\downarrow}$ with dispersion $\varepsilon_{\mathrm{lump}}$ and spectral gap $\gamma$ (on the quotient). Then for all $t$ in a compact interval,
\[
\big|\Lambda_P(t;S)-\Lambda_{P^{\downarrow}}(t;S^{\downarrow})\big|\ \le\ C\cdot \varepsilon_{\mathrm{lump}}/\gamma,
\]
and likewise for first/second derivatives; hence AB scores are stable up to $O(\varepsilon_{\mathrm{lump}}/\gamma)$. 
\end{theorem}
\noindent\emph{Sketch.} Log spectral radius is Lipschitz in the operator norm on appropriate invariant cones; quotienting is a small perturbation when dispersion is controlled, and the gap prevents resonance \parencite{Chung1997,DemboZeitouni1998,elliott2025qfi}.

\begin{corollary}[Idiom transport alignment]
Under Blackwell-sufficient projections the FI curvature is preserved, hence tilted occupancies and AB align across idioms; otherwise FI contracts and AB weakens in the receiving idiom \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982,elliott2025qfi}.
\end{corollary}

% =========================
\section{Connections to classical centralities}\label{sec:connections}
% =========================
\paragraph{Random-walk betweenness.}
In the reversible, near-$t=0$ regime and for path-based $S$, AB rankings match random-walk betweenness \parencite{Newman2005}. The match follows from linear response with $r=\pi$ and $\ell=\mathbf{1}$ (reversible symmetrization) and from the interpretation of $D_t$ as a Doob-like transform of path weights.

\paragraph{Current-flow centrality.}
On undirected networks with conductance weights, effective resistances relate hitting/commute times and current flows; AB reduces to current-flow betweenness under linear response and potential-theoretic identities \parencite{DoyleSnell1984,LevinPeresWilmer2009}.

\paragraph{Kemeny’s constant and scale.}
The sensitivity $\Lambda''(0)$ ties to asymptotic variance and to the Kemeny–Snell constant, fixing the natural “unit” of scale for occupancy deviations \parencite{KemenySnell1976,LevinPeresWilmer2009}.

% =========================
\section{Murphy horizons for discovery}\label{sec:murphy}
% =========================
For rare $S$ (small $\pi(S)$), the LDP with rate $I$ yields
\[
\Prob\!\left(\frac1T\!\sum_{t=0}^{T-1}\!\1\{X_t\in S\}\ \ge \ \theta\right)
\ \approx\ \exp\{-T\,I(\theta)\}.
\]
Set a budget–risk pair $(\alpha,\beta)$; the \emph{Murphy horizon}
\[
L_c(\theta;\alpha,\beta)\ \approx\ \frac{\log(1/\beta)}{\alpha\,I(\theta)}
\]
specifies a schedule that is invariant under quotienting up to $O(\varepsilon_{\mathrm{lump}}/\gamma)$ by \Cref{thm:qfi}. Empirically, EMD constants align these horizons with drift/mixing baselines \parencite{MeynTweedie2009,elliott2025drift,LevinPeresWilmer2009}.

% =========================
\section{Algorithms}\label{sec:alg}
% =========================
All routines are implementable with sparse linear algebra.

\paragraph{Tilted spectral radius and derivatives.}
Given $P$ (sparse) and indicator $f$, for each $t$:
\begin{enumerate}[leftmargin=1.25em]
\item Form $P_t=\mathrm{diag}(e^{t f})P$ without densifying (store $e^{t f}$ separately).
\item Compute the leading eigenpair $(\rho(t),r_t)$ by power or Arnoldi; left vector by adjoint power on $P_t^\top$.
\item Normalize $\ell_t^\top r_t=1$; then $\Lambda'(t)=\ell_t^\top (f\odot r_t)$ and $\Lambda''(t)$ from second-order perturbation.
\item \emph{AB} for an edge $(u\!\to\! v)$ uses the sensitivity $\partial\log\rho/\partial P_t(u,v)=\ell_t(u)\,r_t(v)$ under a conservative row perturbation.
\end{enumerate}
Complexity is near-linear per $t$ for sparse graphs.

\paragraph{Quotienting (QFI).}
Given a partition $\mathcal{P}$, form $P^{\downarrow}$ by averaging transitions across blocks; track dispersion $\varepsilon_{\mathrm{lump}}$ as the maximal $L^1$ row discrepancy.

\begin{algorithm}[h]
\caption{Action--Betweenness map at tilt $t$}
\begin{algorithmic}[1]
\Require Sparse $P$, indicator $f$, tilt $t$
\State $d \gets e^{t f}$; \quad define $P_t$ by row-scaling $P$ with $d$
\State Compute top eigenpair $(\rho,r_t)$ of $P_t$; compute $\ell_t$ of $P_t^\top$; normalize $\ell_t^\top r_t=1$
\For{edge $(u\!\to\! v)\in E$}
  \State $s(u\!\to\! v) \gets \ell_t(u)\, r_t(v)$ \Comment{local sensitivity}
\EndFor
\State \textbf{return} $\{s(e)\}_{e\in E}$ and node aggregation $s(v)=\sum_{e\ni v} s(e)$
\end{algorithmic}
\end{algorithm}

\paragraph{Mathematica package.}
We supply \texttt{FlowCentrality.wl} implementing these routines (see auxiliary file).

% =========================
\section{Examples}\label{sec:examples}
% =========================
\paragraph{Two-community bottleneck.}
A pair of dense subgraphs linked by a weak cut edge; AB places near-total mass on the cut at moderate positive $t$, while at $t=0$ rankings approach random-walk betweenness \parencite{Newman2005}.

\paragraph{Expander baseline.}
On a lazy $d$-regular expander, centrality flattens; Murphy horizons scale as $\Theta(\log n)$ for fixed $S$ mass, consistent with mixing \parencite{HooryLinialWigderson2006,LevinPeresWilmer2009}.

\paragraph{BA--FRC.}
AB highlights the compromised role boundary; QFI stability shows robustness of the diagnosis under aggregation; Murphy horizons match observed detection latencies up to constant factors \parencite{elliott2025bafrc,elliott2025qfi}.

% =========================
\section{Interop with the stack}\label{sec:interop}
% =========================
\textbf{Contracts.} Compile-time $\sigma$-contracts guarantee that the targets $S$ and restrictions are measurable and support-respecting \parencite{elliott2025contracts,elliott2025graded}. \textbf{Drift.} EMD ensures coverage and discoverability, feeding Murphy schedules \parencite{elliott2025drift,MeynTweedie2009}. \textbf{Idiom transport.} FI/CRLB sufficiency preserves curvature and stabilizes AB \parencite{Blackwell1953,AmariNagaoka2000,Cencov1982}. \textbf{Quotients.} QFI provides spectral–LDP invariance and dispersion diagnostics \parencite{elliott2025qfi}.

% =========================
\section{Proof sketches}\label{sec:proofs}
% =========================
\paragraph{Legendre dual and LDP.}
For sub-stochastic tilts on finite $V$, $\Lambda$ is differentiable and steep; the G\"artner–Ellis conditions yield the LDP for $\bar f_T$ with rate $I$ \parencite{DemboZeitouni1998}.

\paragraph{Sensitivity and AB.}
Let $P_t(\epsilon)=P_t+\epsilon\,E_{uv}$ be a conservative edge perturbation. Standard analytic perturbation gives $d\log\rho/d\epsilon=\ell_t(u) r_t(v)$ at $\epsilon=0$; row renormalization contributes only second order to $\log\rho$ under conservative adjustments \parencite{Chung1997}.

\paragraph{Quotient stability.}
Viewing $P^{\downarrow}$ as $P$ plus a structured perturbation whose operator norm is bounded by $\varepsilon_{\mathrm{lump}}$, Weyl-type and cone-preserving arguments bound $|\Lambda_P-\Lambda_{P^{\downarrow}}|$ and derivatives when the quotient has gap $\gamma$ \parencite{Chung1997,elliott2025qfi}.

% =========================
\section{Limitations}\label{sec:limits}
% =========================
Large lumpability dispersion or vanishing gaps weaken stability. Non-ergodic decompositions require per-class analysis. AB captures \emph{routing fragility}, not task utility; use constrained MDP layers to couple centrality to objectives \parencite{Altman1999,Puterman1994}.

% =========================
\section{Conclusion}\label{sec:conclusion}
% =========================
Flow Centrality packages occupancy, sensitivity, and large deviations into an invariant diagnostic for routing. It stands on spectral tilts (for scores and horizons), quotient stability (for portability), and classical limits (for sanity), and it plugs straight into the rest of the stack.

\printbibliography
\end{document}